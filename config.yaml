Title: Sigma to Wazuh Converter Config
Info: false
Debug: false

Sigma:
  BaseUrl: https://github.com/SigmaHQ/sigma/tree/master/rules
  RulesRoot: ../sigma/rules

  # Convert only rules with these statuses
  RuleStatus:
    - stable
    - test

  # Sigma rule IDs to skip (Sysmon Events 16, 27-29 not supported)
  SkipIds:
    - 8ac03a65-6c84-4116-acad-dc1558ff7a77  # Event 16
    - 23b71bc5-953e-4971-be4c-c896cda73fc2  # Event 27
    - c3e5c1b1-45e9-4632-b242-27939c170239  # Event 28
    - 693a44e9-7f26-4cb6-b787-214867672d3a  # Event 29

  # Convert all rules (overrides ConvertCategories/Services/Products)
  ConvertAll: false

  # Filter by category, service, or product
  ConvertCategories:
  ConvertServices:
  ConvertProducts:
    - windows
    - linux

  SkipProducts:
  SkipServices:
  SkipCategories:

Wazuh:
  RulesFile: ./sigma.xml
  RuleIdStart: 200000
  RuleIdFile: ./rule_ids.json

  # Split large files (0 = disabled, recommended: 500)
  MaxRulesPerFile: 300

  # Product-specific ID ranges (10000 IDs per product)
  # Windows: 200400+ (reserves 200000-200399 for parents)
  # Linux: 210007+ (reserves 210000-210006 for parents)
  ProductRuleIdStart:
    windows: 200400
    linux: 210007
    azure: 220000
    m365: 230000

  # Sigma level to Wazuh level mapping
  Levels:
    informational: 5
    low: 7
    medium: 10
    high: 12
    critical: 15

  Options:
    NoFullLog: true
    EmailAlert: false
    SigmaIdEmail:
    EmailLevels:
      - critical
      - high

  # Parent rule mappings
  SidGrpMaps:
    SigmaIdToWazuhGroup:
    SigmaIdToWazuhId:
    ProductServiceToWazuhGroup:
    CategoryToWazuhGroup:

    # Service-specific parent rules
    ProductServiceToWazuhId:
      application: 60003
      security: 60001
      system: 60002

      # ========================================================================
      # Windows Built-in Event Channels (Custom parent rules 100001-100012)
      # ========================================================================
      # Requires parent rule files: 1000[01-12]-*_parent.xml
      # Note: Service names corrected from official Sigma mappings:
      #   - ldap_debug (not "ldap")
      #   - smbclient-connectivity (not "smbserver-connectivity")
      #   - dns-server vs dns-server-analytic are SEPARATE services!
      # ========================================================================
      codeintegrity-operational: 109998  # Code Integrity events
      firewall-as: 109997                # Windows Firewall Advanced Security
      bits-client: 109996                # BITS Client transfers
      dns-client: 109995                 # DNS Client queries
      ntlm: 109994                       # NTLM authentication
      taskscheduler: 109993              # Task Scheduler events
      dns-server: 109992                 # DNS Server (channel: "DNS Server")
      dns-server-analytic: 109991        # DNS Server Analytical (separate service! channel: Microsoft-Windows-DNS-Server/Analytical)
      ldap_debug: 109990                 # LDAP Client debug (note: service name is ldap_debug not ldap!)
      lsa-server: 109989                 # LSA Server events
      terminalservices-localsessionmanager: 109988  # Terminal Services
      smbclient-security: 109987         # SMB Client security
      smbclient-connectivity: 109986     # SMB Client connectivity (note: smbclient not smbserver!)
      applocker: 109985                  # AppLocker events
      security-mitigations: 109984       # Security Mitigations events
      appxdeployment-server: 109983      # AppX Package Deployment (malicious packages, policy blocks)

      # ========================================================================
      # Rare/Niche Windows Channels (Custom parent rules 100013-100024)
      # ========================================================================
      # Previously used fallback (windows: 60000-60012), now have dedicated parents
      # ========================================================================
      msexchange-management: 109981      # Exchange Server Management (8 rules)
      iis-configuration: 109980          # IIS Web Server Configuration (4 rules)
      ldap: 109979                       # LDAP Client (different from ldap_debug!) (3 rules)
      wmi: 109978                        # WMI Activity (2 rules)
      shell-core: 109977                 # Windows Shell Core (2 rules)
      openssh: 109976                    # OpenSSH Server (1 rule)
      appmodel-runtime: 109975           # AppModel Runtime (1 rule)
      appxpackaging-om: 109974           # AppX Packaging OM (1 rule)
      diagnosis-scripted: 109973         # Windows Diagnostics Scripted (1 rule)
      capi2: 109972                      # Crypto API 2.0 (1 rule)
      microsoft-servicebus-client: 109971 # Service Bus Client (1 rule)
      certificateservicesclient-lifecycle-system: 109970 # Certificate Services Client (1 rule)
      driver-framework: 109999           # DriverFrameworks (USB detection, driver events)
    ######################################################
    # Sigma logsource.category mapping (checked after service, before product)
    # Maps Sigma categories to specific Wazuh parent rule IDs
    # NOTE: Product-specific mappings below. Use the correct mapping based on logsource.product
    CategoryToWazuhId:
      # Windows/Sysmon category mappings
      windows:
        process_creation: 61603        # Sysmon Event 1
        file_change: 61604             # Sysmon Event 2
        network_connection: 61605      # Sysmon Event 3
        sysmon_status: 61606           # Sysmon Event 4
        driver_load: 61608             # Sysmon Event 6
        image_load: 61609              # Sysmon Event 7
        create_remote_thread: 61610    # Sysmon Event 8
        raw_access_thread: 61611       # Sysmon Event 9
        process_access: 61612          # Sysmon Event 10
        file_event: 61613              # Sysmon Event 11
        registry_add: 61614            # Sysmon Event 12
        registry_delete: 61614         # Sysmon Event 12
        registry_event: 61614          # Sysmon Event 12
        registry_set: 61615            # Sysmon Event 13
        registry_rename: 61616         # Sysmon Event 14
        create_stream_hash: 61617      # Sysmon Event 15
        file_access: 61617             # Sysmon Event 15 (alternate name)
        file_delete: 109212            # Sysmon Event 26 (FileDeleteDetected - preferred over Event 23)
        file_rename: 61604             # Sysmon Event 2 (File Rename)
        # Sysmon new events (Event 16+) - requires 100000-sysmon_new_events.xml
        pipe_created: 61646, 61647     # Sysmon Events 17-18
        dns_query: 61644               # Sysmon Event 22
        wmi_event: 109203, 109204, 109205  # Sysmon Events 19-21
        # clipboard_capture: 109207    # Sysmon Event 24 - DISABLED (privacy/storage concerns, CVE-2022-41120)
        process_tampering: 109208      # Sysmon Event 25
        # DriverFrameworks category - requires 100001-driverframeworks_parent.xml
        driver-framework: 109999       # DriverFrameworks Events 2003, 2100, 2102 (USB detection, etc.)
        # PowerShell categories - StoW auto-generates parent rules 200000-200003
        ps_script: 200000              # PowerShell Script Block Logging (Event 4104)
        ps_module: 200001              # PowerShell Module Logging (Event 4103)
        ps_classic_start: 200002       # PowerShell Classic Start (Event 400)
        ps_classic_provider_start: 200003  # PowerShell Classic Provider Start (Event 600)

      # Linux/Auditd category mappings - StoW auto-generates parent rules 210000-210006
      linux:
        process_creation: 210001       # auditd-execve (command execution)
        file_event: 210002             # auditd-path (file operations)
        file_access: 210002            # auditd-path
        file_change: 210002            # auditd-path
        file_delete: 210002            # auditd-path
        network_connection: 210000     # auditd-syscall
        syscall: 210000                # auditd-syscall
        config_change: 210003          # auditd-config-change
        user_auth: 210004              # auditd-user-cred
        authentication: 210004         # auditd-user-cred
  ######################################################
  # Sigma to Wazuh field name mappings
  # section should match the sigma product field; e.g. windows, linux, mac, apache, check point fw1
  # section/product should be lower case
  FieldMaps:
    # Windows field mappings for Sysmon and built-in channels
    windows:
      Accesses: win.eventdata.accesses
      AccessList: win.eventdata.accessList
      AccessMask: win.eventdata.accessMask
      AccountName: win.eventdata.targetUserName
      Action: win.eventdata.action
      AllowedToDelegateTo: win.eventdata.allowedToDelegateTo
      Application: win.eventdata.application
      ApplicationPath: win.eventdata.applicationPath
      AttributeLDAPDisplayName: win.eventdata.attributeLDAPDisplayName
      AttributeValue: win.eventdata.attributeValue
      AuditPolicyChanges: win.eventdata.auditPolicyChanges
      AuditSourceName: win.eventdata.auditSourceName
      AuthenticationPackage: win.eventdata.authenticationPackageName
      AuthenticationPackageName: win.eventdata.authenticationPackageName
      CallTrace: win.eventdata.callTrace
      Caption: win.eventdata.caption
      Channel: win.eventdata.channel
      ChildImage: win.eventdata.image
      ClassName: win.eventdata.className
      CommandLine: win.eventdata.commandLine
      Company: win.eventdata.company
      ComputerName: win.system.computer
      Contents: win.system.contents
      ContextInfo: win.system.contextInfo
      CurrentDirectory: win.eventdata.currentDirectory
      Data: win.eventdata.data
      Description: win.eventdata.description
      DestAddress: win.eventdata.destAddress
      Destination: win.eventdata.destination
      DestinationHostname: win.eventdata.destinationHostname
      DestinationIp: win.eventdata.destinationIp
      DestinationIsIpv6: win.eventdata.destinationIsIpv6
      DestinationPort: win.eventdata.destinationPort
      Details: win.eventdata.details
      DeviceClassName: win.eventdata.deviceClassName
      DeviceDescription: win.eventdata.deviceDescription
      DeviceName: win.eventdata.deviceName
      DestPort: win.eventdata.destinationPort
      EngineVersion: win.eventdata.engineVersion
      EventID: win.system.eventID
      EventType: win.eventdata.eventType
      FailureCode: win.eventdata.failureCode
      FileName: win.eventdata.fileName
      FileVersion: win.eventdata.fileVersion
      FilterName: win.eventdata.filterName
      FilterOrigin: win.eventdata.filterOrigin
      FolderPath: win.eventdata.image
      GrantedAccess: win.eventdata.grantedAccess
      Hash: win.eventdata.hashes
      Hashes: win.eventdata.hashes
      HostApplication: win.eventdata.hostApplication
      HostName: win.eventdata.hostName
      HostVersion: win.eventdata.hostVersion
      Image: win.eventdata.image
      ImageName: win.eventdata.imageName
      ImagePath: win.eventdata.imagePath
      ImageLoaded: win.eventdata.imageLoaded
      ImpHash: win.eventdata.impHash
      ImpersonationLevel: win.eventdata.impersonationLevel
      Initiated: win.eventdata.initiated
      IntegrityLevel: win.eventdata.integrityLevel
      IpAddress: win.eventdata.ipAddress
      KeyLength: win.eventdata.keyLength
      Keywords: win.eventdata.keywords
      LayerRTID: win.eventdata.layerRTID
      Level: win.system.level
      LogonGuid: win.eventdata.logonGuid
      LogonId: win.eventdata.logonId
      LogonProcessName: win.eventdata.logonProcessName
      LogonType: win.eventdata.logonType
      md5: win.eventdata.hashes
      Message: win.system.message
      ModifyingApplication: win.system.modifyingApplication
      NewName: win.eventdata.newName
      NewTargetUserName: win.eventdata.newTargetUserName
      NewUacValue: win.eventdata.newUacValue
      NewValue: win.eventdata.newValue
      ObjectClass: win.eventdata.objectClass
      ObjectName: win.eventdata.objectName
      ObjectServer: win.eventdata.objectServer
      ObjectType: win.eventdata.objectType
      ObjectValueName: win.eventdata.objectValueName
      OldUacValue: win.eventdata.oldUacValue
      Origin: win.eventdata.origin
      OriginalFileName: win.eventdata.originalFileName
      PackageName: win.eventdata.packageName
      Param1: win.eventdata.param1
      Param2: win.eventdata.param2
      Param3: win.eventdata.param3
      Param4: win.eventdata.param4
      Param5: win.eventdata.param5
      Param6: win.eventdata.param6
      Param7: win.eventdata.param7
      Param8: win.eventdata.param8
      Param9: win.eventdata.param9
      Param10: win.eventdata.param10
      ParentCommandLine: win.eventdata.parentCommandLine
      ParentImage: win.eventdata.parentImage
      ParentIntegrityLevel: win.eventdata.parentIntegrityLevel
      ParentProcessGuid: win.eventdata.parentProcessGuid
      ParentUser: win.eventdata.parentUser
      Payload: win.eventdata.payload
      PipeName: win.eventdata.pipeName
      PrivilegeList: win.eventdata.privilegeList
      ProcessCommandLine: win.eventdata.commandLine
      ProcessID: win.eventdata.processId
      ProcessName: win.eventdata.processName
      ProcessPath: win.eventdata.processPath
      Product: win.eventdata.product
      Properties: win.eventdata.properties
      ProviderContextName: win.eventdata.providerContextName
      ProviderName: win.eventdata.providerName
      Provider_Name: win.eventdata.providerName
      QueryName: win.eventdata.queryName
      RelativeTargetName: win.eventdata.relativeTargetName
      RemoteAddress: win.eventdata.remoteAddress
      SamAccountName: win.eventdata.samAccountName
      ScriptBlockText: win.eventdata.scriptBlockText
      Service: win.eventdata.service
      ServerName: win.eventdata.serverName
      ServiceFileName: win.eventdata.serviceFileName
      ServiceName: win.eventdata.serviceName
      ServiceStartType: win.eventdata.serviceStartType
      ServiceType: win.eventdata.serviceType
      sha1: win.eventdata.hashes
      sha256: win.eventdata.hashes
      ShareName: win.eventdata.shareName
      SidHistory: win.eventdata.sidHistory
      Signature: win.eventdata.signature
      SignatureStatus: win.eventdata.signatureStatus
      Signed: win.eventdata.signed
      Source: win.eventdata.source
      Source_Name: win.eventdata.sourceName
      SourceAddress: win.eventdata.sourceAddress
      SourceImage: win.eventdata.sourceImage
      SourceNetworkAddress: win.eventdata.ipAddress
      SourcePort: win.eventdata.sourcePort
      SourceWorkstation: win.eventdata.workstation
      StartAddress: win.eventdata.startAddress
      StartFunction: win.eventdata.startFunction
      StartModule: win.eventdata.startModule
      State: win.eventdata.state
      Status: win.eventdata.status
      SubcategoryGuid: win.eventdata.subcategoryGuid
      SubjectAccountName: win.eventdata.subjectUserName
      SubjectDomainName: win.eventdata.subjectDomainName
      SubjectLogonId: win.eventdata.subjectLogonId
      SubjectUserName: win.eventdata.subjectUserName
      SubjectUserSid: win.eventdata.subjectUserSid
      Task: win.eventdata.task
      TaskName: win.eventdata.taskName
      TargetFilename: win.eventdata.targetFilename
      TargetImage: win.eventdata.targetImage
      TargetLogonId: win.eventdata.targetLogonId
      TargetName: win.eventdata.targetName
      TargetObject: win.eventdata.targetObject
      TargetOutboundUserName: win.eventdata.targetOutboundUserName
      TargetProcessAddress: win.eventdata.targetProcessAddress
      TargetServerName: win.eventdata.targetServerName
      TargetSid: win.eventdata.targetSid
      TargetUserName: win.eventdata.targetUserName
      TargetUserSid: win.eventdata.targetUserSid
      TicketEncryptionType: win.eventdata.ticketEncryptionType
      TicketOptions: win.eventdata.ticketOptions
      Type: win.eventdata.type
      User: win.eventdata.user
      UserName: win.eventdata.samAccountName
      Value: win.eventdata.value
      WorkstationName: win.eventdata.workstationName
    Zeek:
      answers: data.answers
      c-uri: data.c-uri
      c-useragent: data.c-useragent
      certificate.serial: data.certificate.serial
      cipher: data.cipher
      client_header_names: data.client_header_names
      dst_ip: data.dstip
      dst_port: data.dstport
      endpoint: data.endpoint
      id.orig_h: data.srcip
      id.orig_p: data.srcport
      id.resp_h: data.dstip
      id.resp_p: data.dstport
      name: data.name
      method: data.method
      operation: data.operation
      path: data.path
      qtype_name: data.qtype_name
      query: data.query
      request_body_len: data.request_body_len
      request_type: data.request_type
      resp_mime_types: data.resp_mime_types
      src_ip: data.srcip
      src_port: data.srcport
      service: data.service
      status_code: data.status_code
      uri: data.uri
      z: data.z
    Linux:
      CommandLine: audit.command
      CurrentDirectory: audit.cwd
      DestinationHostname: audit.dest_host
      DestinationIp: audit.dest_ip
      DestinationPort: audit.dest_port
      Image: audit.exe
      Initiated: audit.initiated
      LogonId: audit.ses
      ParentCommandLine: audit.parent_comm
      ParentImage: audit.parent_exe
      TargetFilename: audit.directory.name
      User: audit.uid
      a0: audit.execve.a0
      a1: audit.execve.a1
      a2: audit.execve.a2
      a3: audit.execve.a3
      a4: audit.execve.a4
      a5: audit.execve.a5
      a6: audit.execve.a6
      a7: audit.execve.a7
      auid: audit.auid
      comm: audit.command
      egid: audit.egid
      euid: audit.euid
      exe: audit.exe
      exit: audit.exit
      gid: audit.gid
      key: audit.key
      name: audit.directory.name
      nametype: audit.directory.nametype
      pid: audit.pid
      ppid: audit.ppid
      proctitle: audit.proctitle
      res: audit.res
      syscall: audit.syscall
      type: audit.type
      uid: audit.uid
      unit: audit.unit
    Azure:
      ActivityDetails: azure.properties.activityDetails
      ActivityDisplayName: azure.properties.activityDisplayName
      AppId: azure.properties.appId
      AuthenticationRequirement: azure.properties.authenticationRequirement
      Category: azure.category
      CategoryValue: azure.categoryValue
      ClientApp: azure.properties.clientApp
      Count: azure.count
      HomeTenantId: azure.properties.homeTenantId
      Initiatedby: azure.properties.initiatedBy
      LoggedByService: azure.properties.loggedByService
      NetworkLocationDetails: azure.properties.networkLocationDetails
      Operation: azure.operationName
      OperationName: azure.operationName
      OperationNameValue: azure.operationNameValue
      ResourceDisplayName: azure.properties.resourceDisplayName
      ResourceProviderValue: azure.resourceProviderValue
      ResultDescription: azure.properties.resultDescription
      ResultType: azure.properties.resultType
      Resultdescription: azure.properties.resultDescription
      RiskState: azure.properties.riskState
      Status: azure.status
      Username: azure.properties.userPrincipalName
      Workload: azure.properties.workload
      eventName: azure.operationName
      properties.message: azure.properties.message
      userPrincipalName: azure.properties.userPrincipalName
    M365:
      ApplicationId: m365.ApplicationId
      ClientIP: m365.ClientIP
      ObjectId: m365.ObjectId
      Operation: m365.Operation
      OrganizationId: m365.OrganizationId
      RequestType: m365.RequestType
      ResultStatus: m365.ResultStatus
      UserId: m365.UserId
      Workload: m365.Workload
      eventName: m365.Operation
      eventSource: m365.RecordType
      status: m365.ResultStatus
