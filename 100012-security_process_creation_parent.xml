<!--
  Parent Rule for Windows Security Event 4688 (Process Creation)

  Provides base rule for process creation detection using Security channel
  instead of Sysmon. Less detailed than Sysmon but available on all Windows.

  Channel: Security
  EventID: 4688 (A new process has been created)

  Required Configuration:
  1. Enable audit policy:
     auditpol /set /subcategory:"{0CCE922B-69AE-11D9-BED3-505054503030}" /success:enable

  2. Enable CommandLine logging (CRITICAL):
     reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\Audit /v ProcessCreationIncludeCmdLine_Enabled /f /t REG_DWORD /d 1

  Limitations vs Sysmon Event 1:
  - No OriginalFileName field (renamed executables harder to detect)
  - No Hashes field (no hash-based detection)
  - No ParentCommandLine field
  - No ProcessGuid/ParentProcessGuid
  - CommandLine disabled by default (requires GPO)
  - ProcessId/ParentProcessId in HEX format (not decimal like Sysmon)

  Field Name Differences:
  - Sysmon: Image          → Security: NewProcessName
  - Sysmon: ParentImage    → Security: ParentProcessName
  - Sysmon: User           → Security: SubjectUserName + SubjectDomainName
  - Sysmon: IntegrityLevel → Security: MandatoryLabel (SID format)
  - Sysmon: ProcessId      → Security: NewProcessId (hex)
  - Sysmon: ParentProcessId→ Security: ProcessId (hex, creator process)

  Rule ID: 109982 (Custom parent rule for Security 4688)
  Sigma rules using "service: security" + "category: process_creation": ~143 rules
-->

<group name="windows,security,process_creation,">

  <!-- Parent rule for Security Event 4688 - Process Creation -->
  <rule id="109982" level="3">
    <field name="win.system.channel">Security</field>
    <field name="win.system.eventID">^4688$</field>
    <description>Windows Security Event 4688 - Process Created: $(win.eventdata.newProcessName)</description>
    <options>no_full_log</options>
    <group>windows,security,process_creation,</group>
  </rule>

</group>
